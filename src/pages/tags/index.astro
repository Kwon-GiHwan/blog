---
import { getCollection } from 'astro:content';
import SidebarLayout from '@layouts/SidebarLayout.astro';
import { filterDrafts, getAllTags } from '@utils/index';

// Combine tags from both collections
const allProjects = await getCollection('projects');
const publishedProjects = filterDrafts(allProjects);

const allResearch = await getCollection('research');
const publishedResearch = filterDrafts(allResearch);

const combinedContent = [...publishedProjects, ...publishedResearch];
const allTags = getAllTags(combinedContent);

// Count posts per tag
const tagCounts = allTags.map(tag => ({
  tag,
  count: combinedContent.filter(p => p.data.tags.includes(tag)).length,
}));
---

<SidebarLayout title="All Tags" description="Browse content by tag">
  <div class="mb-12">
    <h1 class="text-4xl font-bold text-gray-900 mb-4">All Tags</h1>
    <p class="text-gray-600">
      {allTags.length} {allTags.length === 1 ? 'tag' : 'tags'} across all content
    </p>
  </div>

  <div class="flex flex-wrap gap-4">
    {tagCounts.map(({ tag, count }) => (
      <a
        href={`/tags/${tag}`}
        class="group px-6 py-4 bg-white border border-gray-200 rounded-lg hover:shadow-md hover:border-blue-600 transition-all"
      >
        <span class="text-lg font-semibold text-gray-900 group-hover:text-blue-600 transition-colors">
          #{tag}
        </span>
        <span class="ml-2 text-sm text-gray-500">({count})</span>
      </a>
    ))}
  </div>

  {allTags.length === 0 && (
    <div class="text-center py-16 border border-dashed border-gray-300 rounded-lg bg-gray-50">
      <p class="text-gray-600 text-lg">No tags yet.</p>
    </div>
  )}
</SidebarLayout>
