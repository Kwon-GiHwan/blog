---
import { getCollection } from 'astro:content';
import SidebarLayout from '@layouts/SidebarLayout.astro';
import ProjectCard from '@components/ProjectCard.astro';
import SearchFilter from '@components/SearchFilter';
import { filterDrafts, sortByDate, getAllTags } from '@utils/index';

const allProjects = await getCollection('projects');
const publishedProjects = sortByDate(filterDrafts(allProjects));

// Get all tags from projects
const allTags = getAllTags(publishedProjects);

// Format posts for SearchFilter component (including raw content)
const formattedPosts = await Promise.all(
  publishedProjects.map(async (project) => {
    const { Content } = await project.render();
    return {
      slug: project.slug,
      title: project.data.title,
      description: project.data.description,
      date: project.data.date.toISOString(),
      tags: project.data.tags,
      image: project.data.image,
      imageAlt: project.data.imageAlt,
      content: project.body, // Raw markdown content for searching
    };
  })
);
---

<SidebarLayout title="All Projects" description="Browse all my projects" maxWidth="wide">
  <div class="mb-10">
    <h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-3 tracking-tight">All Projects</h1>
    <p class="text-gray-600 text-base">
      Browse and search through all my projects
    </p>
  </div>

  <SearchFilter
    client:load
    posts={formattedPosts}
    allTags={allTags}
    collection="projects"
  />
</SidebarLayout>
